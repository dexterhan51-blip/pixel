import React, { useState } from 'react';
import { BrowserRouter, Routes, Route, Link, useLocation } from 'react-router-dom';
import { Home, Calendar, PieChart, Shirt, PlusCircle } from 'lucide-react';

// í˜ì´ì§€ë“¤ ê°€ì ¸ì˜¤ê¸° (Homeì€ ê°„ë‹¨í•´ì„œ ì—¬ê¸°ì— ë‘ )
import Stats from './pages/Stats';
import Log from './pages/Log';

// --- Components ---

const HomePage = ({ level, exp, maxExp, stats }) => (
  <div className="p-6 pb-24 flex flex-col items-center animate-fade-in">
    <header className="w-full flex justify-between items-center mb-10">
      <div>
        <h1 className="text-xl font-bold text-tennis-dark">í•œì„±ì¢…PDë‹˜</h1>
        <p className="text-sm text-gray-500">Lv.{level} í…Œë‹ˆìŠ¤ í”Œë ˆì´ì–´</p>
      </div>
      <div className="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center">âš™ï¸</div>
    </header>

    <div className="relative mb-12 group cursor-pointer">
      <div className="w-48 h-48 bg-white rounded-2xl border-4 border-tennis-green flex items-center justify-center shadow-[0_10px_20px_rgba(42,157,143,0.2)] transition-transform transform group-hover:scale-105">
        <div className="text-7xl animate-bounce">ğŸ¾</div> 
      </div>
      <div className="absolute -top-4 -right-2 bg-tennis-orange text-white px-3 py-1 rounded-full text-xs font-bold shadow-md">
        ì˜¤ëŠ˜ ì»¨ë””ì…˜ ìµœê³ !
      </div>
    </div>

    <div className="w-full max-w-xs mb-8">
      <div className="flex justify-between text-xs mb-2 font-bold text-gray-500">
        <span>EXP</span>
        <span>{exp} / {maxExp}</span>
      </div>
      <div className="w-full h-3 bg-gray-200 rounded-full overflow-hidden">
        <div 
          className="h-full bg-tennis-green transition-all duration-1000 ease-out" 
          style={{ width: `${(exp / maxExp) * 100}%` }}
        ></div>
      </div>
    </div>

    {/* ìµœê³  ìŠ¤íƒ¯ í‘œì‹œ */}
    <div className="bg-white px-6 py-3 rounded-full border border-gray-200 shadow-sm text-sm font-medium text-gray-600">
       í˜„ì¬ ì£¼ë ¥: <span className="text-tennis-green font-bold">í¬í•¸ë“œ Lv.{stats.forehand}</span>
    </div>
  </div>
);

// í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜
const BottomNav = () => {
  const location = useLocation();
  const menu = [
    { name: 'í™ˆ', path: '/', icon: <Home size={20} /> },
    { name: 'ë¶„ì„', path: '/stats', icon: <PieChart size={20} /> },
    { name: 'ê¸°ë¡', path: '/log', icon: <PlusCircle size={36} className="text-tennis-green drop-shadow-md" /> },
    { name: 'ë‹¬ë ¥', path: '/calendar', icon: <Calendar size={20} /> },
    { name: 'ë½ì»¤', path: '/locker', icon: <Shirt size={20} /> },
  ];

  return (
    <nav className="fixed bottom-0 w-full bg-white/90 backdrop-blur-md border-t border-gray-100 flex justify-around py-3 pb-safe z-50">
      {menu.map((item) => (
        <Link 
          key={item.name} 
          to={item.path} 
          className={`flex flex-col items-center text-[10px] transition-colors ${location.pathname === item.path ? 'text-tennis-green font-bold' : 'text-gray-400'}`}
        >
          {item.icon}
          <span className="mt-1">{item.name}</span>
        </Link>
      ))}
    </nav>
  );
};

// --- Main App ---
export default function App() {
  // [Global State] ì•± ì „ì²´ì—ì„œ ê³µìœ ë˜ëŠ” ë°ì´í„°
  const [level, setLevel] = useState(1);
  const [exp, setExp] = useState(20);
  const maxExp = 100;
  
  // ë‚˜ì˜ ëŠ¥ë ¥ì¹˜ (ê¸°ë¡í•  ë•Œë§ˆë‹¤ ì˜¬ë¼ê°)
  const [stats, setStats] = useState({
    forehand: 1, backhand: 1, serve: 1, volley: 1, footwork: 1, mental: 1
  });

  const [logs, setLogs] = useState([]); // ê¸°ë¡ ì €ì¥ì†Œ

  // ê¸°ë¡ ì €ì¥ í•¨ìˆ˜ (Log.jsxì—ì„œ í˜¸ì¶œë¨)
  const handleSaveLog = (logData, gainedStats) => {
    // 1. ë¡œê·¸ ì €ì¥
    setLogs([logData, ...logs]);

    // 2. ìŠ¤íƒ¯ ì—…ë°ì´íŠ¸ (ê¸°ì¡´ ìŠ¤íƒ¯ + ì´ë²ˆì— ì–»ì€ ìŠ¤íƒ¯)
    setStats(prev => ({
      forehand: prev.forehand + gainedStats.forehand,
      backhand: prev.backhand + gainedStats.backhand,
      serve: prev.serve + gainedStats.serve,
      volley: prev.volley + gainedStats.volley,
      footwork: prev.footwork + gainedStats.footwork,
      mental: prev.mental + gainedStats.mental,
    }));

    // 3. ê²½í—˜ì¹˜ íšë“ (ìš´ë™ ì‹œê°„ì— ë¹„ë¡€)
    const gainedExp = Math.floor(logData.duration / 2); // 30ë¶„ ìš´ë™í•˜ë©´ 15exp
    let newExp = exp + gainedExp;
    
    // ë ˆë²¨ì—… ë¡œì§
    if (newExp >= maxExp) {
      newExp = newExp - maxExp;
      setLevel(prev => prev + 1);
      alert("ğŸ‰ ë ˆë²¨ì—…! ìºë¦­í„°ê°€ ì„±ì¥í–ˆìŠµë‹ˆë‹¤!");
    }
    setExp(newExp);
  };

  return (
    <BrowserRouter>
      <div className="min-h-screen bg-gray-50 font-sans text-gray-800">
        <Routes>
          <Route path="/" element={<HomePage level={level} exp={exp} maxExp={maxExp} stats={stats} />} />
          <Route path="/stats" element={<Stats stats={stats} />} />
          <Route path="/log" element={<Log onSave={handleSaveLog} />} />
          <Route path="/calendar" element={<div className="p-10 text-center">ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤</div>} />
          <Route path="/locker" element={<div className="p-10 text-center">ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤</div>} />
        </Routes>
        <BottomNav />
      </div>
    </BrowserRouter>
  );
}